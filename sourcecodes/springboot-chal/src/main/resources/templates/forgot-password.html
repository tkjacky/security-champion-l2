<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Forgot Password - SecBooks</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script th:src="@{/js/jquery.min.js}"></script>
</head>
<body class="bg-light">
<!-- Include navigation fragment -->
<div th:replace="~{fragments/topnav :: topnav}"></div>
<div class="container mt-5" style="max-width: 400px;">
    <div class="card">
        <div class="card-header bg-primary text-white text-center">
            <h4>Forgot Password</h4>
        </div>
        <div class="card-body">
            <form id="forgotForm">
                <div class="mb-3">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">Send Reset Code (via SMS)</button>
                </div>
            </form>
            <div id="resultMsg" class="mt-3 text-center"></div>
        </div>
    </div>
</div>
<script>
$('#forgotForm').submit(function(e) {
    e.preventDefault();
    const email = $('#email').val();
    $('#resultMsg').removeClass('text-danger text-success').text('');
    $.ajax({
        url: '/api/public/self-service-sms',
        type: 'GET',
        headers: { 'Authorization': 'Bearer fake-token' },
        data: { userId: email },
        success: function(res) {
            if (res && res.data && res.data.phone) {
                $('#resultMsg').addClass('text-success').text('A reset code was sent to your phone: ' + res.data.phone);
            } else if (res && res.error) {
                $('#resultMsg').addClass('text-danger').text(res.error);
            } else {
                $('#resultMsg').addClass('text-danger').text('Unable to process request.');
            }
        },
        error: function() {
            $('#resultMsg').addClass('text-danger').text('Unable to process request.');
        }
    });
});
</script>
<!-- Include navigation script fragment -->
<div th:replace="~{fragments/topnav :: topnav-script}"></div>
</body>
</html>
